---
import GitHubIcon from "../icons/GitHub.astro";
import LinkedInIcon from "../icons/LinkedIn.astro";
import MailIcon from "../icons/Mail.astro";
import SocialPill from "../icons/SocialPill.astro";
import SectionContainer from "../components/SectionContainer.astro";

// --- Iconos para la biograf칤a (mejor que emojis) ---
const BriefcaseIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-5 text-white/80"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.007a2.25 2.25 0 0 1-2.25 2.25h-12a2.25 2.25 0 0 1-2.25-2.25v-4.007M12 10.75h.008v.008H12v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>`;

const GraduationCapIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-5 text-white/80"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.906 59.906 0 0 1 10.399 5.84c-1.033.25-2.096.423-3.21.513m-13.065 0C3.42 9.98 3.322 9.873 3.228 9.75c-.217-.288-.425-.59-.622-.916a25.068 25.068 0 0 1 11.19-4.43c.128.056.255.113.38.172a25.068 25.068 0 0 1 11.19 4.43c-.197.326-.405.628-.622.916-.094.123-.192.23-.288.33m-13.065 0c.288-.26.59-.516.904-.76 1.033-.824 2.152-1.558 3.324-2.164a25.068 25.068 0 0 1 4.268 0c1.172.606 2.291 1.34 3.324 2.164.314.244.616.5.904.76" /></svg>`;
---

<div class="hero-container">
  <canvas id="particle-canvas"></canvas>

  <div class="text-overlay">
    <img
      src="/yo_jp_i.png"
      alt="Foto de Joan"
      id="profileImage"
      class="profile-img animate-fade-in"
    />

    <h1 class="text-gradient animate-fade-in delay-100">Hola, soy Joan</h1>

    <SectionContainer
      class="p-0 bg-transparent animate-fade-in delay-200"
      id="top"
    >
      <h2
        class="text-lg lg:text-xl opacity-90 text-wrap max-w-[700px] text-white"
      >
        <span class="block"> Desarrollador Full Stack en EasyEcommerce. </span>
        <span class="block text-white/70">
          Estudiante de Ingenier칤a de Software en la UTN.
        </span>

        <br />
        Desarrollador de <span class="text-gradient-flag"
          >Imbabura, Ecuador</span
        >. Me especializo en Desarrollo Web, Desarrollo M칩vil y Administraci칩n
        de Bases de Datos.
      </h2>

      <nav
        class="flex gap-4 mt-8 flex-wrap text-white justify-center animate-fade-in delay-300"
      >
        <SocialPill href="https://github.com/2k12">
          <GitHubIcon class="size-4 md:size-6" />
          GitHub
        </SocialPill>
        <SocialPill
          href="https://www.linkedin.com/in/joan-pastillo-donoso-7823272a1/"
        >
          <LinkedInIcon class="size-4 md:size-6" />
          LinkedIn
        </SocialPill>
        <SocialPill href="mailto:jeipige@gmail.com">
          <MailIcon class="size-4 md:size-6" />
          jeipige@gmail.com
        </SocialPill>
      </nav>
    </SectionContainer>
  </div>
</div>

<style>
  body {
    margin: 0;
    background-color: #000;
  }

  .hero-container {
    width: 100%;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }

  #particle-canvas {
    position: fixed; /* Usamos fixed para que siempre est칠 de fondo */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none; /* Dejamos que el overlay reciba clics */
  }

  /* CAMBIO 5: 
    Simplificamos los estilos de la imagen. 
    Ya no necesitamos el 'container' ni el 'button'.
  */
  .profile-img {
    width: clamp(150px, 25vw, 200px); /* Ligeramente m치s peque침o y flexible */
    aspect-ratio: 1/1; /* Mantiene la proporci칩n 1:1 */
    object-fit: cover;
    border-radius: 50%;
    border: 4px solid white;
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
    transition: opacity 0.3s ease;
  }

  .text-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    text-align: center;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-y: auto;
    box-sizing: border-box;
    gap: 1.5rem; /* 24px */

    /* --- 游녢 LA SOLUCI칍N RESPONSIVE 游녢 --- */

    /* 1. M칍VIL (DEFAULT):
    Usamos 'flex-start' y 'padding-top' para control manual.
    'min-height: 100%' asegura que ocupe al menos la pantalla,
    permitiendo el scroll si es necesario.
  */
    justify-content: flex-start;
    padding: 6rem 1rem 4rem 1rem; /* 96px arriba (para librar el header) */
    min-height: 100%;

    /* 2. DESKTOP (md: 768px y m치s):
    En pantallas m치s grandes, el contenido cabe.
    Reactivamos el centrado vertical y ajustamos el padding.
  */
    @media (min-width: 768px) {
      justify-content: center;
      padding: 4rem 1rem 4rem 1rem; /* Padding m치s equilibrado */
      min-height: 100vh; /* Volvemos a 100vh */
    }
  }

  /* CAMBIO 6: 
    Actualizamos el gradiente para que coincida con tu marca.
  */
  .text-gradient {
    font-family: "Arial", sans-serif;
    font-size: clamp(2.5rem, 6vw, 5rem);
    font-weight: bold;
    background: linear-gradient(to right, #7e3af2, #fc6610);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
  }

  /* CAMBIO 7: 
    Nuevas clases de "highlight" para la biograf칤a.
  */
  .text-gradient-flag {
    background: linear-gradient(to right, #ffce00, #007fff, #ff0000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 600;
  }
  .text-brand-purple {
    color: #a78bfa; /* Un morado claro legible */
    font-weight: 600;
  }
  .text-brand-orange {
    color: #fca5a5; /* Un naranja/rojo claro legible */
    font-weight: 600;
  }

  /* CAMBIO 8: 
    Animaciones de entrada.
  */
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in-up 0.5s ease-out forwards;
    opacity: 0; /* Inicia oculto */
  }

  /* Retrasos para la animaci칩n escalonada */
  .delay-100 {
    animation-delay: 0.1s;
  }
  .delay-200 {
    animation-delay: 0.2s;
  }
  .delay-300 {
    animation-delay: 0.3s;
  }
</style>

<script>
  import * as THREE from "three";

  document.addEventListener("DOMContentLoaded", () => {
    // --- CAMBIO 9: L칩gica de Switch Eliminada ---
    // Todo el c칩digo de 'image1', 'image2', 'switchButton' se ha ido.

    // --- CAMBIO 10: Inicializaci칩n de Three.js Limpia ---
    const canvas = document.getElementById(
      "particle-canvas"
    ) as HTMLCanvasElement | null;
    if (!canvas) return;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    const renderer = new THREE.WebGLRenderer({
      canvas: canvas, // Pasamos el canvas directamente
      antialias: true,
      alpha: true,
    });

    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    // Ya no necesitamos 'container.appendChild(renderer.domElement);'

    const particlesCount = 5000;
    const positions = new Float32Array(particlesCount * 3);
    for (let i = 0; i < particlesCount * 3; i++) {
      positions[i] = (Math.random() - 0.5) * 10;
    }
    const particlesGeometry = new THREE.BufferGeometry();
    particlesGeometry.setAttribute(
      "position",
      new THREE.BufferAttribute(positions, 3)
    );
    const particlesMaterial = new THREE.PointsMaterial({
      size: 0.02,
      color: 0xffffff,
    });
    const particleSystem = new THREE.Points(
      particlesGeometry,
      particlesMaterial
    );
    scene.add(particleSystem);
    camera.position.z = 5;

    // --- L칩gica de Parallax (Sin cambios, es buena) ---
    const mouse = new THREE.Vector2();
    window.addEventListener("mousemove", (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
    });

    const clock = new THREE.Clock();
    const animate = () => {
      requestAnimationFrame(animate);

      // --- CAMBIO 11: Rotaci칩n m치s sutil ---
      particleSystem.rotation.y = clock.getElapsedTime() * 0.05; // M치s lento

      // El efecto parallax de la c치mara est치 genial
      camera.position.x += (mouse.x * 0.5 - camera.position.x) * 0.02;
      camera.position.y += (mouse.y * 0.5 - camera.position.y) * 0.02;

      camera.lookAt(scene.position);
      renderer.render(scene, camera);
    };

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });

    animate();
  });
</script>
