---
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";

// --- 1. GESTIÓN DEL CONTENIDO ---
const ACTIVITIES = [
  {
    type: "Evento",
    title: "Participación en 'Semilleros UTN'",
    description:
      "3er Lugar. Desarrollo de Plataforma tecnológica con Moneda Virtual para participación estudiantil.",
    date: "Agosto 2025",
    place: "UTN, Ecuador",
    image: "/activities/sem_25.jpeg",
    objectPosition: "center top", // Updated specifically
  },
  {
    type: "Ponencia",
    title: "IV Congreso Internacional de Semilleros",
    description:
      "Ponencia sobre Plataformas tecnológicas y criptoactivos en ecosistemas universitarios.",
    date: "Octubre 2025",
    place: "UPAO, Perú",
    image: "/activities/upao_25.jpeg",
  },
  {
    type: "Evento",
    title: "INNOVATECH IV Edición 2025",
    description:
      "Representante de Ingeniería de Software. Innovación en sistemas de incentivos académicos.",
    date: "Noviembre 2025",
    place: "UTM, Ecuador",
    image: "/activities/innovatech_25.jpeg",
  },
];
---

<Layout
  title="Activities | Joan"
  description="Trayectoria y eventos."
>
  <main class="bg-black min-h-screen relative overflow-hidden selection:bg-white selection:text-black">
    
    <!-- Header Minimalista -->
    <header class="fixed top-0 left-0 w-full z-40 mix-blend-difference px-6 py-8 pointer-events-none">
       <!-- El header global ya está ahí, esto es solo spacer si es necesario o título de sección -->
    </header>

    <div class="relative w-full max-w-5xl mx-auto px-6 pt-32 pb-20 z-10">
      
      <!-- Título Grande -->
      <h1 class="text-[clamp(3rem,8vw,8rem)] font-bold text-white leading-[0.9] tracking-tighter mb-24 opacity-0 animate-title">
        <!-- Selected<br/>Activities. -->
        Actividades 
      </h1>

      <!-- Lista de Actividades -->
      <div class="activities-wrapper flex flex-col gap-y-32">
        {
          ACTIVITIES.map((activity, index) => (
            <div class="activity-item group relative flex flex-col md:flex-row gap-10 md:items-start opacity-0" data-speed={1 + index * 0.1}>
              
              <!-- Info (Sticky en desktop para efecto parallax) -->
              <div class="md:w-1/3 md:sticky md:top-40 self-start">
                  <span class="block text-xs font-mono text-zinc-500 mb-4 tracking-widest uppercase">{activity.date} — {activity.place}</span>
                  <h2 class="text-3xl md:text-4xl font-medium text-white mb-6 group-hover:text-zinc-300 transition-colors">
                    {activity.title}
                  </h2>
                  <div class="h-[1px] w-12 bg-white/20 my-6 group-hover:w-full transition-all duration-700 ease-out"></div>
                  <p class="text-zinc-400 text-sm leading-relaxed max-w-xs text-balance">
                    {activity.description}
                  </p>
                  <div class="mt-4">
                     <span class="inline-block px-3 py-1 border border-white/10 rounded-full text-[10px] text-white/60 uppercase tracking-widest backdrop-blur-md">
                        {activity.type}
                     </span>
                  </div>
              </div>

              <!-- Imagen con Efecto Reveal -->
              <div class="md:w-2/3 relative overflow-hidden rounded-sm cursor-none image-container">
                <div class="overlay absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500 z-10"></div>
                <!-- Imagen con parllax interno -->
                 <img
                    src={activity.image}
                    alt={activity.title}
                    class="w-full h-[60vh] object-cover filter grayscale group-hover:grayscale-0 transition-all duration-700 ease-out scale-105 group-hover:scale-100"
                    loading="lazy"
                    style={{ objectPosition: (activity as any).objectPosition || "center" }}
                  />
              </div>

            </div>
          ))
        }
      </div>
    </div>

    <!-- Mouse Follower Custom -->
    <div id="cursor-circle" class="fixed w-4 h-4 bg-white rounded-full pointer-events-none mix-blend-difference z-50 top-0 left-0 hidden md:block"></div>

  </main>
  
  <Footer />
</Layout>

<script>
  import { gsap } from "../animations/core";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  
  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("astro:page-load", () => {
    
    // 1. Reveal Título
    gsap.to(".animate-title", {
       opacity: 1,
       y: 0,
       duration: 1.5,
       ease: "power4.out",
       yPercent: 50
    });

    // 2. Actividades (Physics / Parallax)
    const items = gsap.utils.toArray<HTMLElement>(".activity-item");

    items.forEach((item, i) => {
        // Reveal inicial simple
        gsap.fromTo(item, 
          { opacity: 0, y: 100 },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: "power3.out",
            scrollTrigger: {
              trigger: item,
              start: "top 80%",
              end: "top 50%",
              toggleActions: "play none none reverse"
            }
          }
        );

        // Efecto Parallax en la imagen interna
        const img = item.querySelector("img");
        if (img) {
          gsap.fromTo(img,
            { yPercent: -15 },
            {
              yPercent: 15,
              ease: "none",
              scrollTrigger: {
                trigger: item,
                start: "top bottom",
                end: "bottom top",
                scrub: true
              }
            }
          );
        }
    });

    // 3. Custom Cursor Physics
    const cursor = document.getElementById("cursor-circle");
    const imageContainers = document.querySelectorAll(".image-container");

    if (cursor) {
        let mouseX = 0;
        let mouseY = 0;
        let cursorX = 0;
        let cursorY = 0;

        window.addEventListener("mousemove", (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        // Físicas del cursor (Lerp)
        gsap.ticker.add(() => {
            const dt = 1.0 - Math.pow(1.0 - 0.15, gsap.ticker.deltaRatio());
            cursorX += (mouseX - cursorX) * dt;
            cursorY += (mouseY - cursorY) * dt;
            
            gsap.set(cursor, { x: cursorX, y: cursorY, xPercent: -50, yPercent: -50 });
        });

        // Hover Effect en imágenes
        imageContainers.forEach(container => {
           container.addEventListener("mouseenter", () => {
              gsap.to(cursor, { scale: 4, duration: 0.3, ease: "power2.out" });
           });
           container.addEventListener("mouseleave", () => {
              gsap.to(cursor, { scale: 1, duration: 0.3, ease: "power2.out" });
           });
        });
    }

  });
</script>
