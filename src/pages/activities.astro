---
import Layout from "../layouts/Layout.astro";
import SectionContainer from "../components/SectionContainer.astro";

// --- 1. GESTI√ìN DEL CONTENIDO ---
// A√±ade aqu√≠ todas tus actividades.
// El 'type' cambiar√° el color del icono en el timeline.
const ACTIVITIES = [
  //   {
  //     type: "Ponencia", // 'Ponencia' o 'Evento'
  //     title: "IA Generativa en el Desarrollo Web Moderno",
  //     description:
  //       "Una charla sobre el impacto de la IA en los flujos de trabajo de frontend y backend, presentada en la Conferencia de Tecnolog√≠a de 2024.",
  //     date: "Octubre 2024",
  //     place: "Universidad T√©cnica del Norte - UTN, Ecuador.",
  //     image: "/activities/ponencia_ia.webp", // Reemplaza con tu imagen
  //   },
  {
    type: "Evento",
    title: "Participaci√≥n en 'Semilleros UTN'",
    description:
      "Miembro del equipo ganador del 3er Lugar, desarrollando una Plataforma tecnol√≥gica para promover la participaci√≥n estudiantil mediante una Moneda Virtual.",
    date: "Agosto 2025",
    place: "Universidad T√©cnica del Norte (UTN), Ecuador.",
    image: "/activities/sem_25.jpeg", // Reemplaza con tu imagen
  },
  {
    type: "Ponencia",
    title:
      "Participaci√≥n en el IV Congreso Internacional de Semilleros de Investigaci√≥n e Innovaci√≥n.",
    description:
      "Ponencia ‚ÄúPlataforma tecnol√≥gica para promover la participaci√≥n estudiantil en los procesos universitarios mediante una moneda virtual‚Äù.",
    date: "Octubre 2025",
    place: "Universidad Privada Antenor Orrego (UPAO), Per√∫.",
    image: "/activities/upao_25.jpeg", // Reemplaza con tu imagen
  },
  {
    type: "Ponencia",
    title: "Participaci√≥n en INNOVATECH IV Edici√≥n 2025",
    description:
      "Integrante del equipo representante de la carrera de Ingenier√≠a de Software, encargado del desarrollo de una plataforma tecnol√≥gica orientada a fomentar la participaci√≥n estudiantil mediante el uso de una moneda virtual.",
    date: "Noviembre 2025",
    place: "Universidad T√©cnica de Manab√≠ (UTM), Ecuador.",
    image: "/activities/innovatech_25.jpeg",
  },

  // ... a√±ade m√°s actividades aqu√≠
];

// --- Iconos para el Timeline (Dise√±o UI) ---
const ICONS = {
  Ponencia: `
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125H10.5m0-11.25H13.5m0-3.375a1.125 1.125 0 0 1 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125H10.5m0-1.125h3.375c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-3.375M3.375 19.5c.621 0 1.125-.504 1.125-1.125v-11.25c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125Z" />
    </svg>
  `,
  Evento: `
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
    </svg>
  `,
};
---

<Layout
  title="Portfolio Joan - Actividades"
  description="Explora mi trayectoria, ponencias y participaci√≥n en eventos."
>
  <main>
    <div class="hero-container">
      <canvas id="particle-canvas"></canvas>

      <div class="content-overlay">
        <div
          id="lobby-content"
          class="text-center transition-opacity duration-1000"
        >
          <SectionContainer
            id="lobby"
            class="flex flex-col items-center justify-center min-h-[80vh]"
          >
            <!-- <h1 class="text-5xl md:text-7xl font-bold text-gradient mb-4">
              Mi Trayectoria
            </h1> -->
            <!-- <p class="text-xl md:text-2xl text-white/80">Neurodanza</p> -->
          </SectionContainer>
        </div>

        <div
          id="activities-list"
          class="opacity-0 pointer-events-none transition-opacity duration-1000 delay-500"
        >
          <SectionContainer id="timeline-section" class="section-wide">
            <div class="timeline-container">
              {
                ACTIVITIES.map((activity, index) => (
                  <div class="timeline-item">
                    <div class="timeline-content-wrapper">
                      <div
                        class:list={[
                          "timeline-icon",
                          activity.type === "Ponencia"
                            ? "icon-ponencia"
                            : "icon-evento",
                        ]}
                      >
                        <Fragment
                          set:html={ICONS[activity.type as keyof typeof ICONS]}
                        />
                      </div>

                      <article class="timeline-card">
                        <img
                          src={activity.image}
                          alt={`Imagen de ${activity.title}`}
                          class="card-image"
                          loading="lazy"
                        />
                        <div class="card-content">
                          <span class="card-date">{activity.date}</span>
                          <h3 class="card-title">{activity.title}</h3>
                          <p class="card-description">{activity.description}</p>
                          <span class="card-place">{activity.place}</span>
                        </div>
                      </article>
                    </div>
                  </div>
                ))
              }
            </div>
          </SectionContainer>
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  /* --- 2. ESTILOS DE P√ÅGINA Y 3D --- */
  body {
    margin: 0;
    background-color: #000;
    overflow-x: hidden;
  }

  .hero-container {
    position: relative;
    width: 100%;
    /* Permitimos que crezca con el contenido del timeline */
    min-height: 100vh;
    height: auto;
    overflow: hidden;
  }

  #particle-canvas {
    position: fixed; /* FIJO para que se quede de fondo */
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh; /* Ocupa toda la ventana */
    z-index: 0;
    pointer-events: auto; /* PERMITE CLICS */
    cursor: pointer; /* Indica que es interactivo */
  }

  .content-overlay {
    position: relative;
    z-index: 2;
    padding: 6rem 1rem 4rem 1rem;
    width: 100%;
    box-sizing: border-box;
    /* Necesario para que el lobby se centre */
    display: flex;
    flex-direction: column;
  }

  /* Oculta la lista de actividades al inicio */
  #activities-list.opacity-0 {
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
  }

  /* Muestra la lista de actividades post-animaci√≥n */
  #activities-list.is-visible {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0px);
  }

  .text-gradient {
    background: linear-gradient(to right, #7e3af2, #fc6610);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .section-wide {
    width: 100%;
    max-width: 1024px;
    margin: 0 auto;
  }

  /* --- 3. ESTILOS DEL TIMELINE (UX/UI) --- */

  .timeline-container {
    position: relative;
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 0;
  }

  /* La l√≠nea vertical central (solo en desktop) */
  @media (min-width: 768px) {
    .timeline-container::before {
      content: "";
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 4px;
      margin-left: -2px;
      background: linear-gradient(to bottom, #7e3af2, #fc6610, #7e3af2);
      border-radius: 2px;
      opacity: 0.3;
    }
  }

  .timeline-item {
    position: relative;
    width: 100%;
    padding: 1rem 0;
    margin-bottom: 2rem;
  }

  /* Posicionamiento de items (alternado en desktop) */
  @media (min-width: 768px) {
    .timeline-item {
      width: 50%;
      padding: 1rem 2rem;
      padding-right: 3rem;
    }
    /* Item Izquierdo */
    .timeline-item:nth-child(odd) {
      left: 0;
      text-align: right;
    }
    /* Item Derecho */
    .timeline-item:nth-child(even) {
      left: 50%;
      padding-left: 3rem;
      padding-right: 2rem;
    }
  }

  .timeline-content-wrapper {
    position: relative;
  }

  /* El icono en el centro */
  .timeline-icon {
    position: absolute;
    z-index: 10;
    display: none;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(5px);
    border: 2px solid;
    /* Posici√≥n por defecto (m√≥vil) */
    top: 0;
    left: 0;
  }

  .icon-ponencia {
    border-color: #7e3af2;
    color: #7e3af2;
  }
  .icon-evento {
    border-color: #fc6610;
    color: #fc6610;
  }

  @media (min-width: 768px) {
    .timeline-icon {
      display: flex;
      top: 50%;
      transform: translateY(-50%);
    }
    /* Icono Izquierdo */
    .timeline-item:nth-child(odd) .timeline-icon {
      right: -25px; /* (Mitad del icono) - 3rem (padding) */
      left: auto;
      transform: translate(50%, -50%);
    }
    /* Icono Derecho */
    .timeline-item:nth-child(even) .timeline-icon {
      left: -25px; /* (Mitad del icono) - 3rem (padding) */
      transform: translate(-50%, -50%);
    }
  }

  /* La tarjeta de contenido */
  .timeline-card {
    background: rgba(20, 20, 20, 0.5); /* Glassmorphism */
    backdrop-filter: blur(10px);
    border: 1px solid rgba(126, 58, 242, 0.3);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    /* Padding para m√≥vil */
    /* padding-top: 60px;  */
    padding-top: 0; /* Espacio para el icono en m√≥vil */
  }

  .timeline-card:hover {
    transform: translateY(-5px);
    border-color: rgba(126, 58, 242, 0.7);
    box-shadow: 0 10px 30px rgba(126, 58, 242, 0.2);
  }

  .card-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
    object-position: center top; /* üîπ centra la imagen */
    border-bottom: 1px solid rgba(126, 58, 242, 0.3);
  }

  .card-content {
    padding: 1.5rem;
    text-align: left; /* Siempre a la izquierda para legibilidad */
  }

  .card-date {
    display: block;
    font-size: 0.875rem;
    color: #fc6610; /* Color acento */
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  .card-place {
    display: block;
    font-size: 0.875rem;
    color: #908d8b; /* Color acento */
    font-weight: 600;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
  }

  .card-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.75rem;
  }

  .card-description {
    font-size: 1rem;
    color: white;
    line-height: 1.6;
  }
</style>

<script>
  // --- 4. L√ìGICA DE THREE.JS (El Mundo) ---
  import * as THREE from "three";

  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("particle-canvas");
    if (!container) return;

    // --- Configuraci√≥n B√°sica ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    const renderer = new THREE.WebGLRenderer({
      antialias: true,
      alpha: true,
      canvas: container,
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    camera.position.z = 5;

    // --- L√≥gica de Part√≠culas (Ambiental) ---
    const particlesCount = 3000;
    const positions = new Float32Array(particlesCount * 3);
    for (let i = 0; i < particlesCount * 3; i++) {
      positions[i] = (Math.random() - 0.5) * 10;
    }

    const particlesGeometry = new THREE.BufferGeometry();
    particlesGeometry.setAttribute(
      "position",
      new THREE.BufferAttribute(positions, 3)
    );
    const particlesMaterial = new THREE.PointsMaterial({
      size: 0.02,
      color: 0xffffff,
      opacity: 1, // Opacidad inicial
      transparent: true, // Necesario para desvanecer
    });
    const particleSystem = new THREE.Points(
      particlesGeometry,
      particlesMaterial
    );
    scene.add(particleSystem);

    // --- El Mundo Central ---
    const planetGeometry = new THREE.SphereGeometry(1.5, 32, 32);
    // Usamos Wireframe para el "tono" tecnol√≥gico que pediste.
    // El color morado conecta con tu marca.
    const planetMaterial = new THREE.MeshBasicMaterial({
      color: 0x7e3af2,
      wireframe: true,
    });
    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
    scene.add(planet);

    // --- L√≥gica de Interacci√≥n (Raycaster) ---
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    let explorationTriggered = false; // Flag para evitar m√∫ltiples clics
    const targetScale = new THREE.Vector3(50, 50, 50); // Escala final del planeta

    const lobbyContent = document.getElementById("lobby-content");
    const activitiesList = document.getElementById("activities-list");

    function onPlanetClick(event: MouseEvent) {
      if (explorationTriggered) return; // No hacer nada si ya se clicke√≥

      // Calcular posici√≥n del mouse para el Raycaster
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects([planet]);

      // ¬°Se hizo clic en el planeta!
      if (intersects.length > 0) {
        explorationTriggered = true; // Activar la animaci√≥n
        if (container) container.style.cursor = "default"; // Restaurar cursor

        // Ocultar Lobby (UX)
        if (lobbyContent) lobbyContent.style.opacity = "0";

        // Mostrar Timeline (UX)
        if (activitiesList) activitiesList.classList.add("is-visible");
      }
    }

    window.addEventListener("click", onPlanetClick);

    // --- Bucle de Animaci√≥n ---
    function animate() {
      requestAnimationFrame(animate);

      if (explorationTriggered) {
        // --- Estado 2: Animaci√≥n de "Exploraci√≥n" ---

        // 1. Expandir el planeta
        planet.scale.lerp(targetScale, 0.03); // 'lerp' para suavidad

        // 2. Girar el planeta (ahora es el fondo)
        planet.rotation.y += 0.0005;
        planet.rotation.x += 0.0002;

        // 3. Desvanecer las part√≠culas
        if (particlesMaterial.opacity > 0) {
          particlesMaterial.opacity -= 0.01; // Desvanecimiento suave
        }
      } else {
        // --- Estado 1: Animaci√≥n de "Lobby" ---

        // Rotaci√≥n ambiental lenta
        particleSystem.rotation.y += 0.0003;
        particleSystem.rotation.x += 0.0001;
        planet.rotation.y += 0.001;
      }

      renderer.render(scene, camera);
    }

    animate();

    // --- Responsivo (THREE.js) ---
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });
  });
</script>
